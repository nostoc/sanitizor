import ballerina/io;
import ballerinax/smartsheet;

configurable string accessToken = ?;

public function main() returns error? {
    smartsheet:Client smartsheetClient = check new ({
        auth: {
            token: accessToken
        }
    });

    decimal sheetId = 123456789;
    string proofId = "proof-123";

    ProofsGetAllProofsHeaders getAllHeaders = {
        authorization: "Bearer " + accessToken
    };

    ProofsGetAllProofsQueries getAllQueries = {
        pageSize: 100,
        includeAll: false,
        page: 1
    };

    io:println("Step 1: Retrieving all existing proofs for the sheet...");
    ProofDetailListResponse allProofs = check smartsheetClient->/sheets/[sheetId]/proofs(getAllHeaders, ...getAllQueries);
    io:println("Retrieved proofs: ", allProofs);

    ProofRequestBody requestBody = {
        sendTo: [
            {
                email: "stakeholder1@example.com"
            },
            {
                email: "stakeholder2@example.com"
            }
        ],
        ccMe: true,
        subject: "Design Approval Required - Please Review",
        message: "Please review and approve the attached design proof. Your feedback is needed by end of week."
    };

    ProofsCreateProofRequestsHeaders createHeaders = {
        authorization: "Bearer " + accessToken,
        contentType: "application/json"
    };

    io:println("Step 2: Creating a new proof request for stakeholder review...");
    ProofRequestCreateResponse proofRequest = check smartsheetClient->/sheets/[sheetId]/proofs/[proofId]/requests(requestBody, createHeaders);
    io:println("Created proof request: ", proofRequest);

    UpdateProofStatusRequest statusUpdate = {
        isCompleted: false
    };

    ProofsUpdateHeaders updateHeaders = {
        authorization: "Bearer " + accessToken
    };

    io:println("Step 3: Updating proof status to reflect current approval state...");
    ProofResponse updatedProof = check smartsheetClient->/sheets/[sheetId]/proofs/[proofId](statusUpdate, updateHeaders);
    io:println("Updated proof status: ", updatedProof);

    io:println("Proof review workflow completed successfully!");
}